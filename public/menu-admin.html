<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>아즈니섬 메뉴 관리</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #333; text-align: center; }
        .auth-section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        .menu-section {
            margin-bottom: 30px;
        }
        .menu-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background-color: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #e9ecef;
        }
        .menu-item input[type="text"] {
            margin: 0 10px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            flex: 1;
        }
        .menu-item select {
            margin: 0 10px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-danger { background-color: #dc3545; color: white; }
        .btn-secondary { background-color: #6c757d; color: white; }
        .options-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .option-group {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
        }
        .option-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }
        .option-item input {
            margin-right: 10px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            flex: 1;
        }
        #authStatus {
            color: #28a745;
            font-weight: bold;
        }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🏝️ 아즈니섬 메뉴 관리</h1>
        
        <div class="auth-section">
            <h3>인증</h3>
            <input type="password" id="password" placeholder="관리자 비밀번호" style="padding: 10px; margin-right: 10px; border: 1px solid #ddd; border-radius: 4px;">
            <button onclick="authenticate()" class="btn-primary">로그인</button>
            <div id="authStatus" class="hidden">✅ 인증됨</div>
        </div>

        <div id="menuManager" class="hidden">
            <div class="menu-section">
                <h3>메뉴 목록</h3>
                <div style="margin-bottom: 15px; padding: 15px; background-color: #e3f2fd; border-radius: 5px; border-left: 4px solid #2196f3;">
                    <div style="color: #666; font-size: 14px; margin-bottom: 10px;">
                        <strong>표시명:</strong> 사용자에게 보여지는 이름 | <strong>코드값:</strong> 시스템에서 사용하는 값
                    </div>
                    <div style="color: #333; font-size: 13px;">
                        <strong>카테고리별 옵션:</strong><br>
                        • <strong>커피:</strong> 원두 옵션, 온도 옵션, 추가 옵션 모두 선택 가능 (예: 아메리카노, 카페라떼)<br>
                        • <strong>차:</strong> 온도 옵션, 추가 옵션 선택 가능 (예: 레몬차, 호지차)<br>
                        • <strong>음료:</strong> 온도 옵션, 추가 옵션 선택 가능 (예: 레몬에이드, 자몽에이드)<br>
                        • <strong>병음료:</strong> 추가 옵션만 선택 가능 (예: 분다버그 진저비어)
                    </div>
                </div>
                <div id="menuList"></div>
                <button onclick="addMenuItem()" class="btn-success">+ 메뉴 추가</button>
            </div>

            <div class="options-section">
                <div class="option-group">
                    <h4>원두 옵션 (읽기 전용)</h4>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">커피 카테고리 메뉴에만 적용됩니다</div>
                    <div id="beanOptions"></div>
                </div>

                <div class="option-group">
                    <h4>온도 옵션 (읽기 전용)</h4>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">병음료를 제외한 모든 카테고리에 적용됩니다</div>
                    <div id="temperatureOptions"></div>
                </div>

                <div class="option-group">
                    <h4>추가 옵션 (읽기 전용)</h4>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">모든 메뉴에 적용됩니다</div>
                    <div id="extraOptions"></div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button onclick="saveMenu()" class="btn-primary" style="font-size: 18px; padding: 15px 30px;">💾 메뉴 저장</button>
            </div>
        </div>
    </div>

    <script>
        let menuData = {{MENU_DATA}};
        let isAuthenticated = false;

        function authenticate() {
            const password = document.getElementById('password').value;
            if (password === 'asnisum2025') {
                isAuthenticated = true;
                document.getElementById('authStatus').classList.remove('hidden');
                document.getElementById('menuManager').classList.remove('hidden');
                loadMenuData();
            } else {
                alert('비밀번호가 틀렸습니다.');
            }
        }

        function loadMenuData() {
            renderMenuList();
            renderOptions();
        }

        function renderMenuList() {
            const container = document.getElementById('menuList');
            container.innerHTML = '';
            
            menuData.menus.forEach((menu, index) => {
                const div = document.createElement('div');
                div.className = 'menu-item';
                div.innerHTML = `
                    <input type="text" value="${menu.text}" onchange="updateMenu(${index}, 'text', this.value)" placeholder="표시명 (예: 아메리카노)" style="flex: 1; margin-right: 5px;">
                    <input type="text" value="${menu.value}" onchange="updateMenu(${index}, 'value', this.value)" placeholder="코드값 (예: americano)" style="flex: 1; margin-right: 5px;">
                    <select onchange="updateMenu(${index}, 'category', this.value)" style="margin-right: 5px;">
                        <option value="coffee" ${menu.category === 'coffee' ? 'selected' : ''}>커피 (모든 옵션 선택 가능)</option>
                        <option value="tea" ${menu.category === 'tea' ? 'selected' : ''}>차 (온도/추가 옵션 선택 가능)</option>
                        <option value="ade" ${menu.category === 'ade' ? 'selected' : ''}>음료 (온도/추가 옵션 선택 가능)</option>
                        <option value="bottle" ${menu.category === 'bottle' ? 'selected' : ''}>병음료 (추가 옵션만)</option>
                    </select>
                    <button onclick="removeMenu(${index})" class="btn-danger">삭제</button>
                `;
                container.appendChild(div);
            });
        }

        function renderOptions() {
            renderOptionList('beanOptions', menuData.beanOptions);
            renderOptionList('temperatureOptions', menuData.temperatureOptions);
            renderOptionList('extraOptions', menuData.extraOptions);
        }

        function renderOptionList(containerId, options) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            options.forEach((option, index) => {
                const div = document.createElement('div');
                div.className = 'option-item';
                div.innerHTML = `
                    <span style="flex: 1; padding: 8px; background-color: #f8f9fa; border-radius: 4px; margin-right: 5px;">${option.text}</span>
                    <span style="flex: 1; padding: 8px; background-color: #f8f9fa; border-radius: 4px; color: #666; font-family: monospace;">${option.value}</span>
                `;
                container.appendChild(div);
            });
        }

        function updateMenu(index, field, value) {
            menuData.menus[index][field] = value;
        }

        function addMenuItem() {
            const menuNum = menuData.menus.length + 1;
            menuData.menus.push({
                text: '새 메뉴' + menuNum,
                value: 'new_menu_' + menuNum,
                category: 'coffee'
            });
            renderMenuList();
        }

        function removeMenu(index) {
            menuData.menus.splice(index, 1);
            renderMenuList();
        }


        async function saveMenu() {
            if (!isAuthenticated) {
                alert('인증이 필요합니다.');
                return;
            }

            if (!confirm('메뉴를 저장하시겠습니까? 이 작업은 GitHub에 커밋됩니다.')) {
                return;
            }

            try {
                const response = await fetch('/api/menu-admin', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'save',
                        menuData: menuData,
                        password: document.getElementById('password').value
                    })
                });

                const result = await response.json();
                
                if (response.ok) {
                    alert('메뉴가 성공적으로 저장되었습니다!');
                } else {
                    alert('저장 실패: ' + result.error);
                }
            } catch (error) {
                alert('저장 중 오류가 발생했습니다: ' + error.message);
            }
        }
    </script>
</body>
</html>